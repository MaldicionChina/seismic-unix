#!/usr/bin/make -f
# See debhelper(7) (uncomment to enable)
# output every command that modifies files on the build system.
#DH_VERBOSE = 1


# to build the source into compiled programs and formatted
# documents in the build-tree
build: build-arch
.PHONY: build

# to build the source into arch-dependent compiled programs 
# in the build-tree.
build-arch: patch-stamp
	# Verifica que se realice la llamda desde el directorio correcto
	dh_testdir 
	# Calcula dependencias sobre librerias compartidas
	#dh_shlibdeps
	# directiva para instalar el binario
	$(MAKE) build
.PHONY: build-arch
# to build the source into arch-independent formatted
# documents in the build-tree.

build-indep:
.PHONY: build-indep
# to clean all compiled, generated, and useless 
# files in the build-tree.

clean: clean-patched unpatch
	
.PHONY: clean

clean-patched:
	# Verifica que se realice la llamda desde el directorio correcto
	dh_testdir 
	# Verifica que el usuario que ejecuta la instrucción sea root
	dh_testroot 	
	dh_clean
	$(MAKE) DESTDIR=$(CURDIR)/debian/seismic-unix clean
	
.PHONY: clean-patched
# Se deshacen todos los parches realizados en el código fuente
unpatch:
	dpatch deapply-all
	rm -rf patch-stamp debian/patched
.PHONY: unpatch

patch: patch-stamp
.PHONY: patch

# Se aplican todos los parches 
patch-stamp:
	dpatch apply-all
	dpatch cat-all > patch-stamp
.PHONY: patch-stamp

#to install files into a file tree for each binary package 
# under the debian directory. If defined, binary* targets
# effectively depend on this target. (Optional)

install: 
	# Verifica que se realice la llamda desde el directorio correcto
	dh_testdir 
	# Verifica que el usuario que ejecuta la instrucción sea root
	dh_testroot
	 # Realiza una limpieza para preparar la construcción de un paquete binario - reemplaza a dh_clean -k
	dh_prep
	#Crea subdirectorios en los directorios de construcción del paquete
	#dh_installdirs -a
	# directiva para instalar los archivos listados en packagename.install
	dh_install
.PHONY: install

#target: to create arch-independent 
# (Architecture: all) binary packages in the parent directory.
binary-indep: install
.PHONY: binary-indep

# to create arch-dependent binary packages in the 
# (Architecture: any) parent directory
binary-arch: install
	dh_testdir
	dh_testroot
	dh_installchangelogs
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb
.PHONY: binary-arch

# to create all binary packages (effectively a 
# combination of binary-arch and binary-indep targets
binary: binary-arch




